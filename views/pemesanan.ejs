<!DOCTYPE html>
<html lang="id">
  <head>
    <title><%= title %></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap');
      body { font-family: "Quicksand", sans-serif }
    </style>
  </head>

  <% if (typeof done !== 'undefined' && done) { %>
  <body class="container py-4 bg-light">
    <div class="text-center">
      <h2>Terima kasih, <%= nama_pelanggan %>!</h2>
      <p>Pesanan Anda telah kami terima. Anda memesan:</p>
    </div>
    <ul class="list-group mb-3">
      <% pesanan.forEach(item => { %>
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div><%= item.nama_menu %><br>Rp <%= item.harga.toLocaleString('id-ID') %> x <%= item.jumlah %></div>
        <strong>Rp <%= item.sub_total.toLocaleString('id-ID') %></strong>
      </li>
      <% }) %>
    </ul>
    <div class="text-end fw-bold">Total Harga: Rp <%= total_harga %></div>
  </body>
  <% } else { %>
  <body class="container py-4 bg-light">
    <form action="/pemesanan" method="POST" id="form-pemesanan">
      <input type="hidden" name="id_meja" value="<%= id_meja %>" />
      <input type="hidden" name="menu_pesanan" id="menu-pesanan" />
      <input type="hidden" name="total_harga" id="total-harga" />

      <!-- Step Nama -->
      <div class="form-step">
        <div class="text-center mb-4">
          <h1>Selamat Datang</h1>
          <h2>di Resto UNIKOM</h2>
          <p class="badge text-bg-warning">Anda duduk di meja No. <%= id_meja %></p>
          <p>Masukkan nama Anda sebelum memesan</p>
        </div>
        <div class="mb-3">
          <label for="input-name" class="form-label"><strong>Nama Anda</strong></label>
          <input type="text" class="form-control" id="input-name" name="nama_pelanggan" placeholder="Masukkan nama Anda..." required autofocus>
        </div>
      </div>

      <!-- Step Menu -->
      <div class="form-step d-none">
        <h3 class="mb-3">Pilih Menu</h3>
        <div class="row g-3">
          <% menu.forEach(({ id_menu, nama_menu, harga, jenis_menu }) => { %>
          <div class="col-12 d-flex align-items-center border rounded p-2 bg-white">
            <img src="/img/menu/<%= id_menu %>.jpg" alt="<%= nama_menu %>" class="img-fluid rounded" style="max-width: 100px;">
            <div class="ms-3 flex-grow-1">
              <div class="fw-bold"><%= nama_menu %></div>
              <div class="text-muted small"><% if (jenis_menu === 'MAKANAN'){ %> Makanan <% } else { %> Minuman <% } %><br>Rp <%= harga.toLocaleString('id-ID') %></div>
            </div>
            <button type="button" class="btn btn-primary add-to-cart" data-id="<%= id_menu %>" data-nama="<%= nama_menu %>" data-harga="<%= harga %>">
              Tambah
            </button>
          </div>
          <% }) %>
        </div>
        <hr class="my-4">
        <h4>Pesanan Anda</h4>
        <div id="order-summary" class="border rounded p-3 bg-light">Belum ada pesanan.</div>
      </div>

      <!-- Step Konfirmasi -->
      <div class="form-step d-none">
        <h3 class="mb-3">Konfirmasi Pesanan</h3>
        <div id="final-menu-list" class="mb-3"></div>
        <h5>Total Harga: Rp <span id="total-price">0</span></h5>
      </div>

      <!-- Buttons -->
      <div class="action-buttons d-flex justify-content-between mt-4">
        <button type="button" id="prev-btn" class="btn w-100 btn-secondary d-none">
          <i class="bi bi-arrow-left"></i> Kembali
        </button>
        <button type="button" id="next-btn" class="btn w-100 btn-primary"></button>
      </div>
    </form>

    <script src="/javascripts/pemesanan.js"></script>
  </body>
  <% } %>
</html>
